<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üéâ 2025 AIDE ÏÑºÌÑ∞ ÏÜ°ÎÖÑÌöå</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@400;500;700&display=swap"
      rel="stylesheet" />
    <style>
      :root {
        --bg-gradient-start: #0f0c29;
        --bg-gradient-mid: #302b63;
        --bg-gradient-end: #24243e;
        --gold: #ffd700;
        --gold-light: #ffed4a;
        --gold-dark: #c9a000;
        --card-bg: rgba(255, 255, 255, 0.08);
        --card-border: rgba(255, 255, 255, 0.15);
        --text-primary: #ffffff;
        --text-secondary: rgba(255, 255, 255, 0.7);
        --accent-red: #ff6b6b;
        --accent-green: #51cf66;
        --accent-blue: #4dabf7;
        --accent-purple: #b197fc;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Noto Sans KR', sans-serif;
        background: linear-gradient(
          135deg,
          var(--bg-gradient-start),
          var(--bg-gradient-mid),
          var(--bg-gradient-end)
        );
        min-height: 100vh;
        color: var(--text-primary);
        overflow-x: hidden;
      }

      /* Animated background stars */
      .stars {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        overflow: hidden;
        z-index: 0;
      }

      .star {
        position: absolute;
        width: 3px;
        height: 3px;
        background: white;
        border-radius: 50%;
        animation: twinkle 2s infinite ease-in-out;
      }

      @keyframes twinkle {
        0%,
        100% {
          opacity: 0.3;
          transform: scale(1);
        }
        50% {
          opacity: 1;
          transform: scale(1.2);
        }
      }

      .container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 2.5rem;
        position: relative;
        z-index: 1;
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
        animation: slideDown 0.8s ease-out;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h1 {
        font-family: 'Black Han Sans', sans-serif;
        font-size: 4.5rem;
        background: linear-gradient(
          135deg,
          var(--gold-light),
          var(--gold),
          var(--gold-dark)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 0 60px rgba(255, 215, 0, 0.5);
        margin-bottom: 0.5rem;
        letter-spacing: 2px;
      }

      .subtitle {
        font-size: 1.5rem;
        color: var(--text-secondary);
      }

      /* Top Action Bar */
      .action-bar {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }

      .action-btn {
        padding: 1rem 2rem;
        font-size: 1.2rem;
        font-weight: 600;
        border: 2px solid var(--card-border);
        border-radius: 30px;
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .action-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: var(--text-primary);
      }

      .action-btn.danger {
        border-color: var(--accent-red);
        color: var(--accent-red);
      }

      .action-btn.danger:hover {
        background: rgba(255, 107, 107, 0.2);
      }

      .action-btn.primary {
        border-color: var(--gold);
        color: var(--gold);
      }

      .action-btn.primary:hover {
        background: rgba(255, 215, 0, 0.2);
      }

      .top-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
      }

      @media (max-width: 768px) {
        .top-grid {
          grid-template-columns: 1fr;
        }
        h1 {
          font-size: 2.2rem;
        }
      }

      .card {
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--card-border);
        border-radius: 28px;
        padding: 2rem;
        animation: fadeIn 0.6s ease-out;
        animation-fill-mode: backwards;
      }

      .card:nth-child(1) {
        animation-delay: 0.1s;
      }
      .card:nth-child(2) {
        animation-delay: 0.2s;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--card-border);
      }

      .card-header .icon {
        font-size: 1.8rem;
      }

      .card-header h2 {
        font-size: 1.4rem;
        font-weight: 700;
      }

      .card-header .count {
        margin-left: auto;
        background: rgba(255, 215, 0, 0.2);
        color: var(--gold);
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 1rem;
        font-weight: 600;
      }

      .card-header .count.excluded {
        background: rgba(177, 151, 252, 0.2);
        color: var(--accent-purple);
        margin-left: 0.5rem;
      }

      textarea {
        width: 100%;
        height: 300px;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid var(--card-border);
        border-radius: 16px;
        padding: 1.25rem;
        color: var(--text-primary);
        font-size: 1.1rem;
        font-family: 'Noto Sans KR', sans-serif;
        resize: vertical;
        transition: all 0.3s ease;
      }

      textarea:focus {
        outline: none;
        border-color: var(--gold);
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
      }

      textarea::placeholder {
        color: var(--text-secondary);
      }

      .prize-list {
        max-height: 350px;
        overflow-y: auto;
        padding-right: 0.5rem;
      }

      .prize-list::-webkit-scrollbar {
        width: 6px;
      }

      .prize-list::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
      }

      .prize-list::-webkit-scrollbar-thumb {
        background: var(--gold-dark);
        border-radius: 3px;
      }

      .prize-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 14px;
        margin-bottom: 0.75rem;
        transition: all 0.3s ease;
      }

      .prize-item:hover {
        background: rgba(0, 0, 0, 0.3);
      }

      .prize-item.completed {
        opacity: 0.5;
        background: rgba(81, 207, 102, 0.1);
      }

      .prize-item.active {
        border: 2px solid var(--gold);
        background: rgba(255, 215, 0, 0.1);
      }

      .prize-rank {
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-weight: 700;
        font-size: 1rem;
        flex-shrink: 0;
      }

      .prize-rank.gold {
        background: linear-gradient(135deg, #ffd700, #ffaa00);
        color: #000;
      }

      .prize-rank.silver {
        background: linear-gradient(135deg, #e8e8e8, #b8b8b8);
        color: #000;
      }

      .prize-rank.bronze {
        background: linear-gradient(135deg, #cd7f32, #a0522d);
        color: #fff;
      }

      .prize-rank.normal {
        background: linear-gradient(135deg, var(--accent-blue), #3250a8);
        color: #fff;
      }

      .prize-info {
        flex: 1;
        min-width: 0;
      }

      .prize-info input {
        width: 100%;
        background: transparent;
        border: none;
        color: var(--text-primary);
        font-size: 1.1rem;
        font-family: 'Noto Sans KR', sans-serif;
      }

      .prize-info input:focus {
        outline: none;
      }

      .prize-qty {
        display: flex;
        align-items: center;
        gap: 0.4rem;
      }

      .prize-qty button {
        width: 26px;
        height: 26px;
        border: none;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 1rem;
      }

      .prize-qty button:hover {
        background: var(--gold);
        color: #000;
      }

      .prize-qty span {
        width: 26px;
        text-align: center;
        font-weight: 600;
        font-size: 0.9rem;
      }

      .delete-prize {
        background: none;
        border: none;
        color: var(--accent-red);
        cursor: pointer;
        font-size: 1.1rem;
        opacity: 0.6;
        transition: all 0.2s ease;
      }

      .delete-prize:hover {
        opacity: 1;
        transform: scale(1.2);
      }

      .draw-prize-btn {
        padding: 0.6rem 1.2rem;
        font-size: 1rem;
        font-weight: 600;
        background: linear-gradient(135deg, var(--gold-light), var(--gold));
        border: none;
        border-radius: 20px;
        color: #000;
        cursor: pointer;
        transition: all 0.3s ease;
        white-space: nowrap;
      }

      .draw-prize-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
      }

      .draw-prize-btn:disabled {
        background: #555;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .add-prize-btn {
        width: 100%;
        padding: 1rem;
        background: rgba(255, 215, 0, 0.1);
        border: 2px dashed var(--gold-dark);
        border-radius: 14px;
        color: var(--gold);
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 0.75rem;
      }

      .add-prize-btn:hover {
        background: rgba(255, 215, 0, 0.2);
        border-style: solid;
      }

      /* Results Section - Below */
      .results-section {
        margin-top: 2rem;
        animation: fadeIn 0.6s ease-out 0.3s backwards;
      }

      .results-section.hidden {
        display: none;
      }

      .results-card {
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--card-border);
        border-radius: 24px;
        padding: 1.5rem;
      }

      .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
        margin-top: 1.5rem;
      }

      .result-item {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 16px;
        padding: 1.5rem;
        animation: popIn 0.4s ease-out;
      }

      @keyframes popIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .result-item.gold-tier {
        border: 2px solid var(--gold);
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
      }

      .result-prize-title {
        font-weight: 700;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1.2rem;
      }

      .result-winners {
        display: flex;
        flex-wrap: wrap;
        gap: 0.6rem;
      }

      .winner-badge {
        background: rgba(255, 215, 0, 0.2);
        color: var(--gold);
        padding: 0.5rem 1rem;
        border-radius: 18px;
        font-size: 1.05rem;
        font-weight: 500;
      }

      .no-results {
        text-align: center;
        color: var(--text-secondary);
        padding: 3rem;
      }

      .no-results .icon {
        font-size: 3rem;
        margin-bottom: 1rem;
      }

      /* Drawing Animation Overlay */
      .drawing-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 100;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }

      .drawing-overlay.active {
        display: flex;
      }

      .drawing-prize-name {
        font-size: 1.8rem;
        color: var(--text-secondary);
        margin-bottom: 1rem;
        text-align: center;
      }

      .drawing-progress {
        font-size: 1rem;
        color: var(--gold);
        margin-bottom: 2rem;
      }

      .slot-machine {
        font-family: 'Black Han Sans', sans-serif;
        text-align: center;
      }

      .drawing-current-name {
        font-size: 5rem;
        color: var(--gold);
        min-height: 120px;
        animation: pulse 0.1s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }

      .drawing-current-name.winner {
        animation: winner-reveal 0.5s ease-out;
      }

      @keyframes winner-reveal {
        0% {
          transform: scale(1.5);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .drawing-winners-so-far {
        margin-top: 2rem;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.5rem;
        max-width: 600px;
      }

      .drawing-winner-badge {
        background: rgba(255, 215, 0, 0.3);
        color: var(--gold);
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-size: 1.1rem;
        font-weight: 600;
        animation: popIn 0.3s ease-out;
      }

      /* Excluded list */
      .excluded-section {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--card-border);
      }

      .excluded-title {
        font-size: 0.85rem;
        color: var(--accent-purple);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.3rem;
      }

      .excluded-names {
        display: flex;
        flex-wrap: wrap;
        gap: 0.3rem;
      }

      .excluded-badge {
        background: rgba(177, 151, 252, 0.2);
        color: var(--accent-purple);
        padding: 0.2rem 0.5rem;
        border-radius: 10px;
        font-size: 0.75rem;
      }
    </style>
  </head>
  <body>
    <!-- Animated Stars Background -->
    <div class="stars" id="stars"></div>

    <div class="container">
      <header>
        <h1>üéä 2025 AIDE ÏÑºÌÑ∞ ÏÜ°ÎÖÑÌöå üéä</h1>
        <p class="subtitle">ÌñâÏö¥Ïùò Ï£ºÏù∏Í≥µÏùÄ ÎàÑÍµ¨?</p>
      </header>

      <!-- Action Bar -->
      <div class="action-bar">
        <button class="action-btn primary" onclick="showResults()">
          üèÜ ÎãπÏ≤® Í≤∞Í≥º Î≥¥Í∏∞
        </button>
        <button class="action-btn danger" onclick="resetAll()">
          üîÑ Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî
        </button>
      </div>

      <div class="top-grid">
        <!-- Participants Card -->
        <div class="card">
          <div class="card-header">
            <span class="icon">üë•</span>
            <h2>Ï∞∏ÏÑùÏûê Î™ÖÎã®</h2>
            <span class="count" id="participant-count">0Î™Ö</span>
            <span
              class="count excluded"
              id="excluded-count"
              style="display: none"
              >Ï†úÏô∏ 0Î™Ö</span
            >
          </div>
          <textarea
            id="participants"
            placeholder="Ï∞∏ÏÑùÏûê Ïù¥Î¶ÑÏùÑ Ìïú Ï§ÑÏóê Ìïú Î™ÖÏî© ÏûÖÎ†•ÌïòÏÑ∏Ïöî.&#10;&#10;ÏòàÏãú:&#10;ÌôçÍ∏∏Îèô&#10;ÍπÄÏ≤†Ïàò&#10;Ïù¥ÏòÅÌù¨&#10;Î∞ïÏßÄÎØº"></textarea>
          <div
            class="excluded-section"
            id="excluded-section"
            style="display: none">
            <div class="excluded-title">‚ú® ÎãπÏ≤®Ïûê (Ï∂îÏ≤® Ï†úÏô∏)</div>
            <div class="excluded-names" id="excluded-names"></div>
          </div>
        </div>

        <!-- Prizes Card -->
        <div class="card">
          <div class="card-header">
            <span class="icon">üéÅ</span>
            <h2>Í≤ΩÌíà Î™©Î°ù</h2>
            <span class="count" id="prize-count">Ï¥ù 0Í∞ú</span>
          </div>
          <div class="prize-list" id="prize-list">
            <!-- Prizes will be added here -->
          </div>
          <button class="add-prize-btn" onclick="addPrize()">
            + Í≤ΩÌíà Ï∂îÍ∞Ä
          </button>
        </div>
      </div>

      <!-- Results Section - Below -->
      <div class="results-section hidden" id="results-section">
        <div class="results-card">
          <div class="card-header">
            <span class="icon">üèÜ</span>
            <h2>Ï∂îÏ≤® Í≤∞Í≥º</h2>
            <span class="count" id="results-count">0Í±¥</span>
          </div>
          <div class="results-grid" id="results-grid">
            <div class="no-results">
              <div class="icon">üé∞</div>
              <p>Í≤ΩÌíàÎ≥ÑÎ°ú Ï∂îÏ≤® Î≤ÑÌäºÏùÑ ÎàåÎü¨<br />ÎãπÏ≤®ÏûêÎ•º ÎΩëÏïÑÎ≥¥ÏÑ∏Ïöî!</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Drawing Animation Overlay -->
    <div class="drawing-overlay" id="drawing-overlay">
      <div class="drawing-prize-name" id="drawing-prize-name"></div>
      <div class="drawing-progress" id="drawing-progress"></div>
      <div class="slot-machine">
        <div class="drawing-current-name" id="drawing-current-name"></div>
      </div>
      <div class="drawing-winners-so-far" id="drawing-winners-so-far"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script>
      // Initialize with some default prizes
      let prizes = [
        {
          id: 1,
          name: 'Î°úÏßÄÌÖç ÎßàÏö∞Ïä§ (MX Anywhere S3)',
          qty: 3,
          completed: false,
          winners: [],
        },
        {
          id: 2,
          name: 'ÌïòÏù¥Ïò® Î¨¥ÏÑ† Í∞ÄÏäµÍ∏∞ G8',
          qty: 5,
          completed: false,
          winners: [],
        },
        {
          id: 3,
          name: 'Îß•ÏÑ∏Ïù¥ÌîÑ 15W Î¨¥ÏÑ†Ï∂©Ï†Ñ Î≥¥Ï°∞Î∞∞ÌÑ∞Î¶¨',
          qty: 5,
          completed: false,
          winners: [],
        },
        {
          id: 4,
          name: 'Í∏∞ÌîÑÌã∞Ïáº Î∞∞ÎØº 2ÎßåÏõê ÏÉÅÌíàÍ∂å',
          qty: 10,
          completed: false,
          winners: [],
        },
        {
          id: 5,
          name: 'Í∏∞ÌîÑÌã∞Ïáº Ïä§ÌÉÄÎ≤ÖÏä§ 1ÎßåÏõê ÏÉÅÌíàÍ∂å',
          qty: 15,
          completed: false,
          winners: [],
        },
        {
          id: 6,
          name: 'Ïï°Ìã∞Î™¨ ÎØ∏Îãà Î≥¥Ï°∞Î∞∞ÌÑ∞Î¶¨ 5000mAh CÌÉÄÏûÖ',
          qty: 20,
          completed: false,
          winners: [],
        },
      ];
      let prizeIdCounter = 6;
      let excludedParticipants = new Set(); // ÎãπÏ≤®ÎêòÏñ¥ Ï†úÏô∏Îêú Ï∞∏ÏÑùÏûê

      // Create stars
      function createStars() {
        const starsContainer = document.getElementById('stars');
        for (let i = 0; i < 100; i++) {
          const star = document.createElement('div');
          star.className = 'star';
          star.style.left = Math.random() * 100 + '%';
          star.style.top = Math.random() * 100 + '%';
          star.style.animationDelay = Math.random() * 2 + 's';
          star.style.animationDuration = 1.5 + Math.random() * 1.5 + 's';
          starsContainer.appendChild(star);
        }
      }

      // Get available participants (excluding winners)
      function getAvailableParticipants() {
        const participantsText = document.getElementById('participants').value;
        const all = participantsText
          .split('\n')
          .map(name => name.trim())
          .filter(name => name !== '');
        return all.filter(name => !excludedParticipants.has(name));
      }

      // Render prizes
      function renderPrizes() {
        const prizeList = document.getElementById('prize-list');
        prizeList.innerHTML = '';

        let totalQty = 0;
        prizes.forEach((prize, index) => {
          totalQty += prize.qty;
          let rankClass = 'normal';
          if (index === 0) rankClass = 'gold';
          else if (index === 1) rankClass = 'silver';
          else if (index === 2) rankClass = 'bronze';

          const prizeEl = document.createElement('div');
          prizeEl.className = 'prize-item';
          if (prize.completed) prizeEl.classList.add('completed');

          const available = getAvailableParticipants();
          const canDraw = !prize.completed && available.length >= prize.qty;

          prizeEl.innerHTML = `
                    <div class="prize-rank ${rankClass}">${index + 1}</div>
                    <div class="prize-info">
                        <input type="text" value="${prize.name}" 
                            onchange="updatePrizeName(${prize.id}, this.value)"
                            placeholder="Í≤ΩÌíàÎ™Ö ÏûÖÎ†•"
                            ${prize.completed ? 'disabled' : ''}>
                    </div>
                    <div class="prize-qty">
                        <button onclick="updatePrizeQty(${prize.id}, -1)" ${
            prize.completed ? 'disabled' : ''
          }>‚àí</button>
                        <span>${prize.qty}</span>
                        <button onclick="updatePrizeQty(${prize.id}, 1)" ${
            prize.completed ? 'disabled' : ''
          }>+</button>
                    </div>
                    ${
                      prize.completed
                        ? '<span style="color: var(--accent-green); font-size: 0.85rem;">‚úì ÏôÑÎ£å</span>'
                        : `<button class="draw-prize-btn" onclick="drawPrize(${
                            prize.id
                          })" ${!canDraw ? 'disabled' : ''}>Ï∂îÏ≤®</button>`
                    }
                    <button class="delete-prize" onclick="deletePrize(${
                      prize.id
                    })" ${
            prize.completed ? 'style="visibility:hidden"' : ''
          }>√ó</button>
                `;
          prizeList.appendChild(prizeEl);
        });

        document.getElementById('prize-count').textContent = `Ï¥ù ${totalQty}Í∞ú`;
      }

      // Render excluded participants
      function renderExcluded() {
        const section = document.getElementById('excluded-section');
        const namesContainer = document.getElementById('excluded-names');
        const countBadge = document.getElementById('excluded-count');

        if (excludedParticipants.size === 0) {
          section.style.display = 'none';
          countBadge.style.display = 'none';
          return;
        }

        section.style.display = 'block';
        countBadge.style.display = 'inline';
        countBadge.textContent = `Ï†úÏô∏ ${excludedParticipants.size}Î™Ö`;

        namesContainer.innerHTML = '';
        excludedParticipants.forEach(name => {
          const badge = document.createElement('span');
          badge.className = 'excluded-badge';
          badge.textContent = name;
          namesContainer.appendChild(badge);
        });
      }

      // Render results
      function renderResults() {
        const resultsGrid = document.getElementById('results-grid');
        const completedPrizes = prizes.filter(p => p.completed);

        if (completedPrizes.length === 0) {
          resultsGrid.innerHTML = `
                    <div class="no-results">
                        <div class="icon">üé∞</div>
                        <p>Í≤ΩÌíàÎ≥ÑÎ°ú Ï∂îÏ≤® Î≤ÑÌäºÏùÑ ÎàåÎü¨<br>ÎãπÏ≤®ÏûêÎ•º ÎΩëÏïÑÎ≥¥ÏÑ∏Ïöî!</p>
                    </div>
                `;
          document.getElementById('results-count').textContent = '0Í±¥';
          return;
        }

        resultsGrid.innerHTML = '';
        completedPrizes.forEach((prize, index) => {
          const resultEl = document.createElement('div');
          resultEl.className = 'result-item';
          if (index === 0) resultEl.classList.add('gold-tier');

          resultEl.innerHTML = `
                    <div class="result-prize-title">
                        ${prize.name}
                    </div>
                    <div class="result-winners">
                        ${prize.winners
                          .map(w => `<span class="winner-badge">${w}</span>`)
                          .join('')}
                    </div>
                `;
          resultsGrid.appendChild(resultEl);
        });

        document.getElementById(
          'results-count',
        ).textContent = `${completedPrizes.length}Í±¥`;
      }

      // Show results section
      function showResults() {
        const section = document.getElementById('results-section');
        section.classList.toggle('hidden');
        if (!section.classList.contains('hidden')) {
          section.scrollIntoView({behavior: 'smooth', block: 'start'});
        }
      }

      function addPrize() {
        prizes.push({
          id: prizeIdCounter++,
          name: 'ÏÉà Í≤ΩÌíà',
          qty: 1,
          completed: false,
          winners: [],
        });
        renderPrizes();
      }

      function updatePrizeName(id, name) {
        const prize = prizes.find(p => p.id === id);
        if (prize && !prize.completed) prize.name = name;
      }

      function updatePrizeQty(id, delta) {
        const prize = prizes.find(p => p.id === id);
        if (prize && !prize.completed) {
          prize.qty = Math.max(1, prize.qty + delta);
          renderPrizes();
        }
      }

      function deletePrize(id) {
        const prize = prizes.find(p => p.id === id);
        if (prize && !prize.completed) {
          prizes = prizes.filter(p => p.id !== id);
          renderPrizes();
        }
      }

      // Update participant count
      document
        .getElementById('participants')
        .addEventListener('input', function () {
          const names = this.value
            .split('\n')
            .filter(name => name.trim() !== '');
          document.getElementById('participant-count').textContent =
            names.length + 'Î™Ö';
          renderPrizes(); // Re-render to update draw button states
        });

      // Shuffle array (Fisher-Yates)
      function shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
      }

      function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      // Draw for a specific prize
      async function drawPrize(prizeId) {
        const prize = prizes.find(p => p.id === prizeId);
        if (!prize || prize.completed) return;

        let available = getAvailableParticipants();

        if (available.length < prize.qty) {
          alert(
            `Ï∂îÏ≤® Í∞ÄÎä•Ìïú Ïù∏Ïõê(${available.length}Î™Ö)Ïù¥ Í≤ΩÌíà ÏàòÎüâ(${prize.qty}Í∞ú)Î≥¥Îã§ Ï†ÅÏäµÎãàÎã§!`,
          );
          return;
        }

        // Shuffle and pick winners
        const shuffled = shuffleArray(available);
        const winners = shuffled.slice(0, prize.qty);

        // Show animation
        await showDrawingAnimation(prize, winners, available);

        // Update state
        prize.winners = winners;
        prize.completed = true;
        winners.forEach(w => excludedParticipants.add(w));

        // Update UI
        renderPrizes();
        renderExcluded();
        renderResults();

        // Confetti!
        launchConfetti();
      }

      async function showDrawingAnimation(prize, winners, allAvailable) {
        const overlay = document.getElementById('drawing-overlay');
        const prizeNameEl = document.getElementById('drawing-prize-name');
        const progressEl = document.getElementById('drawing-progress');
        const currentNameEl = document.getElementById('drawing-current-name');
        const winnersSoFarEl = document.getElementById(
          'drawing-winners-so-far',
        );

        overlay.classList.add('active');
        prizeNameEl.textContent = prize.name;
        winnersSoFarEl.innerHTML = '';

        // Í≤ΩÌíà Í∞úÏàòÍ∞Ä 10Í∞úÎ•º Ï¥àÍ≥ºÌïòÎ©¥ Îπ†Î•∏ Î™®ÎìúÎ°ú Ï†ÑÌôò
        const isFastMode = prize.qty > 10;
        const iterations = isFastMode ? 12 : 25;
        const baseDelay = isFastMode ? 20 : 40;
        const delayIncrement = isFastMode ? 4 : 8;
        const winnerPauseTime = isFastMode ? 400 : 1000;

        for (let i = 0; i < winners.length; i++) {
          const winner = winners[i];
          progressEl.textContent = `${i + 1} / ${winners.length} Ï∂îÏ≤® Ï§ë...`;
          currentNameEl.classList.remove('winner');

          // Slot machine effect
          for (let j = 0; j < iterations; j++) {
            const randomName =
              allAvailable[Math.floor(Math.random() * allAvailable.length)];
            currentNameEl.textContent = randomName;
            await sleep(baseDelay + j * delayIncrement); // Slow down gradually
          }

          // Show winner
          currentNameEl.classList.add('winner');
          currentNameEl.textContent = 'üéâ ' + winner + ' üéâ';

          // Add to winners so far
          const badge = document.createElement('span');
          badge.className = 'drawing-winner-badge';
          badge.textContent = winner;
          winnersSoFarEl.appendChild(badge);

          await sleep(winnerPauseTime);
        }

        progressEl.textContent = 'Ï∂îÏ≤® ÏôÑÎ£å!';
        await sleep(isFastMode ? 400 : 800);

        overlay.classList.remove('active');
      }

      function launchConfetti() {
        const duration = 2000;
        const end = Date.now() + duration;

        (function frame() {
          confetti({
            particleCount: 4,
            angle: 60,
            spread: 55,
            origin: {x: 0},
            colors: ['#ffd700', '#ff6b6b', '#4dabf7', '#51cf66'],
          });
          confetti({
            particleCount: 4,
            angle: 120,
            spread: 55,
            origin: {x: 1},
            colors: ['#ffd700', '#ff6b6b', '#4dabf7', '#51cf66'],
          });

          if (Date.now() < end) {
            requestAnimationFrame(frame);
          }
        })();
      }

      // Reset all - full reset
      function resetAll() {
        if (!confirm('Î™®Îì† Ï∂îÏ≤® Í≤∞Í≥ºÎ•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;

        // Reset prizes
        prizes.forEach(p => {
          p.completed = false;
          p.winners = [];
        });

        // Clear excluded
        excludedParticipants.clear();

        // Update UI
        renderPrizes();
        renderExcluded();
        renderResults();
      }

      // Initialize
      createStars();
      renderPrizes();
      renderResults();
    </script>
  </body>
</html>
